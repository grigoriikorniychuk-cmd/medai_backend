# Скрипты автоматической синхронизации

Этот каталог содержит скрипты для автоматической синхронизации, транскрибации и анализа звонков.

## Описание скриптов

### daily_sync.py

Основной скрипт для выполнения последовательности операций:
1. Синхронизация звонков из AmoCRM
2. Транскрибация аудиофайлов
3. Анализ транскриптов

### setup_cron.sh

Скрипт для настройки автоматического запуска `daily_sync.py` по расписанию через cron.

## Использование

### Ручной запуск

```bash
# Активируем виртуальное окружение (если используется)
# source /path/to/venv/bin/activate

# Переходим в директорию проекта
cd /path/to/medai_backend

# Запускаем скрипт (по умолчанию обрабатывает вчерашний день)
python3 scripts/daily_sync.py

# Для обработки конкретной даты
python3 scripts/daily_sync.py --date 2025-05-20

# Для обработки диапазона дат
python3 scripts/daily_sync.py --start-date 2025-05-20 --end-date 2025-05-25
```

### Настройка автоматического запуска

1. Сделайте скрипт исполняемым:
   ```bash
   chmod +x scripts/setup_cron.sh
   ```

2. Запустите скрипт настройки cron:
   ```bash
   ./scripts/setup_cron.sh
   ```

   Это добавит задачу в cron для ежедневного запуска в 00:00.

### Проверка логов

Логи выполнения скрипта сохраняются в файл:
```
/path/to/medai_backend/logs/daily_sync.log
```

## Требования

- Python 3.8+
- Установленные зависимости из `requirements.txt`
- Доступ к API сервера (переменные окружения должны быть настроены)

## Переменные окружения

Скрипт использует следующие переменные окружения:

- `BASE_URL` - Базовый URL API (по умолчанию: `http://localhost:8000`)
- `API_TOKEN` - Токен аутентификации (если требуется)

## Обратная связь

В случае возникновения проблем, пожалуйста, проверьте логи и убедитесь, что все переменные окружения установлены корректно.
