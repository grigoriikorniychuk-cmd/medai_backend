# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ –ª–∏–º–∏—Ç–æ–≤ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ElevenLabs API –∫–∞–∂–¥–æ–π –∫–ª–∏–Ω–∏–∫–æ–π, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤.

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

- **–õ–∏–º–∏—Ç –Ω–∞ –∫–ª–∏–Ω–∏–∫—É**: 80,000 —Ç–æ–∫–µ–Ω–æ–≤ –≤ –º–µ—Å—è—Ü (~3000 –º–∏–Ω—É—Ç –∞—É–¥–∏–æ)
- **–ü–µ—Ä–∏–æ–¥**: 30 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–±—Ä–æ—Å–∞
- **–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è**: –¢–æ–∫–µ–Ω—ã (—Å–∏–º–≤–æ–ª—ã) –≤ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ç–µ–∫—Å—Ç–µ

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–µ–π

–ü—Ä–∏ –≤—ã–∑–æ–≤–µ `POST /api/calls/transcribe-by-date-range`:
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç –∫–ª–∏–Ω–∏–∫–∏
- –ï—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è **HTTP 403** —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- –ï—Å–ª–∏ –ª–∏–º–∏—Ç –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω, —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

### 2. –£—á–µ—Ç –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–≥–æ –∑–≤–æ–Ω–∫–∞:
- –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –≤ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ç–µ–∫—Å—Ç–µ (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
- –°—á–µ—Ç—á–∏–∫ `current_month_usage` –∫–ª–∏–Ω–∏–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å

–ö–∞–∂–¥—ã–µ 30 –¥–Ω–µ–π:
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `last_reset_date`
- –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ 30+ –¥–Ω–µ–π, `current_month_usage` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –¥–æ 0
- `last_reset_date` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ MongoDB

–ö–æ–ª–ª–µ–∫—Ü–∏—è `clinics`:

```json
{
  "_id": "clinic-uuid",
  "name": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–Ω–∏–∫–∏",
  "monthly_limit": 80000,
  "current_month_usage": 15430,
  "last_reset_date": "2025-09-30T00:00:00",
  ...
}
```

## API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–∏–º–∏—Ç–∞–º–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ (–ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ)

```python
from app.services.clinic_limits_service import check_clinic_limit

limit_info = await check_clinic_limit(client_id)

if limit_info["allowed"]:
    print(f"–û—Å—Ç–∞–ª–æ—Å—å: {limit_info['remaining']} —Ç–æ–∫–µ–Ω–æ–≤")
else:
    print(f"–õ–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω!")
```

### –£—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤

```python
from app.services.clinic_limits_service import increment_clinic_usage

success = await increment_clinic_usage(client_id, tokens_used=1500)
```

## –ú–∏–≥—Ä–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –≤—Å–µ—Ö –∫–ª–∏–Ω–∏–∫ —Å 100 –Ω–∞ 80,000 —Ç–æ–∫–µ–Ω–æ–≤:

```bash
cd /path/to/medai_backend
python3 scripts/update_clinic_limits.py
```

–°–∫—Ä–∏–ø—Ç:
- –ù–∞–π–¥–µ—Ç –≤—Å–µ –∫–ª–∏–Ω–∏–∫–∏ –≤ –±–∞–∑–µ
- –û–±–Ω–æ–≤–∏—Ç `monthly_limit` –Ω–∞ 80,000
- –°–æ—Ö—Ä–∞–Ω–∏—Ç —Ç–µ–∫—É—â–∏–π `current_month_usage` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –í—ã–≤–µ–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç:
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–∞ —Å –æ—Å—Ç–∞—Ç–∫–æ–º
- üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ 90%+ –ª–∏–º–∏—Ç–∞
- ‚ùå –û—Ç–∫–∞–∑—ã –≤ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤

```
‚úÖ –õ–∏–º–∏—Ç –∫–ª–∏–Ω–∏–∫–∏ Elitstom: 15430/80000 —Ç–æ–∫–µ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ, –æ—Å—Ç–∞–ª–æ—Å—å 64570 —Ç–æ–∫–µ–Ω–æ–≤
üìä –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ 1243 —Ç–æ–∫–µ–Ω–∞ (—Å–∏–º–≤–æ–ª–æ–≤)
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è –∫–ª–∏–Ω–∏–∫–∏: +1243 —Ç–æ–∫–µ–Ω–æ–≤
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–Ω–∏–∫–∏ Elitstom: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ 16673/80000 —Ç–æ–∫–µ–Ω–æ–≤ (20.8%), –æ—Å—Ç–∞–ª–æ—Å—å 63327 —Ç–æ–∫–µ–Ω–æ–≤
```

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ 90%+ –ª–∏–º–∏—Ç–∞:
```
‚ö†Ô∏è –ö–ª–∏–Ω–∏–∫–∞ Elitstom –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ 92.3% –º–µ—Å—è—á–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞!
```

## –û—Ç–≤–µ—Ç—ã API –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

### –û—à–∏–±–∫–∞ HTTP 403

```json
{
  "detail": {
    "error": "–ü—Ä–µ–≤—ã—à–µ–Ω –º–µ—Å—è—á–Ω—ã–π –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏",
    "clinic_name": "Elitstom",
    "monthly_limit": 80000,
    "current_usage": 80145,
    "remaining": -145
  }
}
```

## –§–æ—Ä–º—É–ª—ã –∏ —Ä–∞—Å—á–µ—Ç—ã

### –û—Ü–µ–Ω–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞—É–¥–∏–æ

```
–¢–æ–∫–µ–Ω—ã ‚âà –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å_–≤_—Å–µ–∫—É–Ω–¥–∞—Ö √ó 15
```

**–ü—Ä–∏–º–µ—Ä**: 
- –ê—É–¥–∏–æ 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥) ‚âà 4,500 —Ç–æ–∫–µ–Ω–æ–≤
- –ê—É–¥–∏–æ 10 –º–∏–Ω—É—Ç (600 —Å–µ–∫—É–Ω–¥) ‚âà 9,000 —Ç–æ–∫–µ–Ω–æ–≤

### –ö–æ–Ω–≤–µ—Ä—Å–∏—è –º–∏–Ω—É—Ç—ã ‚Üî —Ç–æ–∫–µ–Ω—ã

–ò–∑ —Ç–∞—Ä–∏—Ñ–∞ ElevenLabs Creator:
- 3771 –º–∏–Ω—É—Ç–∞ = 100,000 —Ç–æ–∫–µ–Ω–æ–≤
- **1 –º–∏–Ω—É—Ç–∞ ‚âà 26.5 —Ç–æ–∫–µ–Ω–æ–≤**
- **3000 –º–∏–Ω—É—Ç ‚âà 80,000 —Ç–æ–∫–µ–Ω–æ–≤**

## FAQ

**Q: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –∫–ª–∏–Ω–∏–∫–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏?**  
A: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–ø–µ—Ä–µ–¥** –∑–∞–ø—É—Å–∫–æ–º –º–∞—Å—Å–æ–≤–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏. –ï—Å–ª–∏ –ª–∏–º–∏—Ç —É–∂–µ –ø—Ä–µ–≤—ã—à–µ–Ω, —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–ª–∏–Ω–∏–∫–∏?**  
A: –î–∞, –æ–±–Ω–æ–≤–∏—Ç–µ –ø–æ–ª–µ `monthly_limit` –≤ MongoDB –¥–ª—è —ç—Ç–æ–π –∫–ª–∏–Ω–∏–∫–∏.

**Q: –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ª–∏ –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏?**  
A: –ù–µ—Ç, —Ç–æ–∫–µ–Ω—ã —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ **—É—Å–ø–µ—à–Ω–æ–π** —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ (—Å—Ç–∞—Ç—É—Å `success`).

**Q: –ö–∞–∫ –≤—Ä—É—á–Ω—É—é —Å–±—Ä–æ—Å–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –∫–ª–∏–Ω–∏–∫–∏?**  
A: –û–±–Ω–æ–≤–∏—Ç–µ –≤ MongoDB:
```javascript
db.clinics.updateOne(
  { _id: "clinic-uuid" },
  { 
    $set: { 
      current_month_usage: 0, 
      last_reset_date: new Date().toISOString() 
    } 
  }
)
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ª–∏–º–∏—Ç–∞–º–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫
2. –ó–Ω–∞—á–µ–Ω–∏—è `monthly_limit` –∏ `current_month_usage` –≤ MongoDB
3. –î–∞—Ç—É `last_reset_date` (–¥–æ–ª–∂–Ω–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 30 –¥–Ω–µ–π)
